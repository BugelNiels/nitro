<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NITRO: Project Structure</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../logo48x48.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NITRO
   &#160;<span id="projectnumber">1.3.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d6/d44/md_docs_PROJECT_STRUCTURE.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Project Structure </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The project was developed with the aim of making it easily extendable. Below a number of code details are outlined to illustrate some basic example usages of the project and how to extend it.</p>
<h2><a class="anchor" id="autotoc_md21"></a>
Modules</h2>
<p>NITRO works with a module system for its node. By using this module system, users can determine at compile-time which modules to include and which modules to exclude. These modules are then automatically registered when the program starts.</p>
<p>The different modules can be found in the <a href="../../../modules">modules/</a> directory. Currently, there are two modules here:</p>
<ul>
<li><b>ImCore</b>. This is the main module. It provides support for basic image operations and the image viewer widget.</li>
<li><b>ImExtra</b>. Contains additional image processing routines such as morphological operators and frequency domain related operators.</li>
<li><b>Im3D</b>. This module contains some nodes that can be used to compress and enhance bit-depth. Additionally, it contains a widget that allows for viewing of images as 3D objects:</li>
</ul>
<p>Adding new modules can be done by following a similar structure to the existing module:</p>
<ul>
<li>Create a new directory in the <code>modules</code> directory. The folder structure should be all lower-case.</li>
<li>Create an implementation of <code>imcoremodule.hpp</code>. This implementation should register the new nodes, in addition to the data types and widgets (if there are any).</li>
<li>Create a <code>CMakeLists.txt</code> to create a library of the module. See e.g. <a href="../../../modules/imcore/CMakeLists.txt">this CMakeLists.txt</a> on how to do this. Note that any libraries used in the module, must unfortunately still be found and linked in the main <a href="../../../CMakeLists.txt">CMakeLists.txt</a>. A future release should hopefully fix this issue.</li>
<li>Add any nodes, data types or widgets as needed (see below).</li>
</ul>
<p>The basic directory structure will then look as follows:</p>
<div class="fragment"><div class="line">└── modules</div>
<div class="line">    ├── im3d</div>
<div class="line">    ├── imcore</div>
<div class="line">    ├── imextra</div>
<div class="line">    └── &lt;new module&gt;</div>
<div class="line">        ├── CMakeLists.txt</div>
<div class="line">        ├── include</div>
<div class="line">        │   └── &lt;my module&gt;module.hpp</div>
<div class="line">        └── src</div>
<div class="line">            ├── &lt;my module&gt;module.cpp</div>
<div class="line">            ├── gui       # Dock widgets go here</div>
<div class="line">            └── nodes     # Node implementation go here</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md22"></a>
Nodes</h2>
<p>Nodes are built using the builder-pattern to ensure maximum flexibility. As such, new nodes are not created by creating a subclass of <code>NitroNode</code>. Instead, nodes are built dynamically at runtime. Each node will typically have a <code>NodeOperator</code>. This operator is what performs the actual computation of the node. For details on how to construct a node, you can look at the <a href="../../../include/nodes/nitronodebuilder.hpp">NitroNodeBuilder</a> class.</p>
<p>A simple implementation of a denoising node is then as follows:</p>
<p><a href="../../../modules/improc/src/nodes/blur/bilateralfilter.hpp">Header file</a></p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">#pragma once</div>
<div class="line"> </div>
<div class="line">#include &lt;nodes/nodeoperator.hpp&gt;</div>
<div class="line">#include &lt;nodes/nitronode.hpp&gt;</div>
<div class="line"> </div>
<div class="line">namespace nitro {</div>
<div class="line"> </div>
<div class="line">    /**</div>
<div class="line">     * Node that performs Bilateral filtering on an input image.</div>
<div class="line">     */</div>
<div class="line">    class BilateralFilterOperator : public NodeOperator {</div>
<div class="line">    public:</div>
<div class="line">        /**</div>
<div class="line">         * Responsible for creating a function that builds this node.</div>
<div class="line">         *</div>
<div class="line">         * @param category Category name this node should be put in.</div>
<div class="line">         * @return A function that creates this particular node.</div>
<div class="line">         */</div>
<div class="line">        static std::function&lt;std::unique_ptr&lt;NitroNode&gt;()&gt; creator(const QString &amp;category);</div>
<div class="line"> </div>
<div class="line">        /**</div>
<div class="line">         * Executes the Bilateral filtering algorithm of this node on the current input data.</div>
<div class="line">         * @param nodePorts Port data containing the current input and output information.</div>
<div class="line">         * @param options Options for passing additional parameters to the algorithm. Currently unused.</div>
<div class="line">         */</div>
<div class="line">        void execute(NodePorts &amp;nodePorts) override;</div>
<div class="line"> </div>
<div class="line">    };</div>
<div class="line">} // nitro</div>
</div><!-- fragment --><p><a href="../../../modules/improc/src/nodes/blur/bilateralfilter.cpp">Source file</a></p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">#include &quot;bilateralfilter.hpp&quot;</div>
<div class="line">#include &lt;nodes/nitronodebuilder.hpp&gt;</div>
<div class="line">#include &quot;nodes/datatypes/colimagedata.hpp&quot;</div>
<div class="line">#include &lt;opencv2/imgproc.hpp&gt;</div>
<div class="line"> </div>
<div class="line">#define INPUT_IMAGE &quot;Image&quot;</div>
<div class="line">#define INPUT_SIGMA_C &quot;Sigma (c)&quot;</div>
<div class="line">#define INPUT_SIGMA_S &quot;Sigma (s)&quot;</div>
<div class="line">#define INPUT_D &quot;Diameter&quot;</div>
<div class="line">#define OUTPUT_IMAGE &quot;Image&quot;</div>
<div class="line">#define MODE_DROPDOWN &quot;Mode&quot;</div>
<div class="line"> </div>
<div class="line">void nitro::BilateralFilterOperator::execute(NodePorts &amp;nodePorts) {</div>
<div class="line">    if(!nodePorts.allInputsPresent()) {</div>
<div class="line">        return;</div>
<div class="line">    }</div>
<div class="line">    // Get the input data</div>
<div class="line">    auto inputImg = nodePorts.inGetAs&lt;ColImageData&gt;(INPUT_IMAGE);</div>
<div class="line">    double sigmaCol = nodePorts.inputValue(INPUT_SIGMA_C);</div>
<div class="line">    double sigmaSpace = nodePorts.inputValue(INPUT_SIGMA_S);</div>
<div class="line">    int d = nodePorts.inputInteger(INPUT_D);</div>
<div class="line"> </div>
<div class="line">    // Perform filtering</div>
<div class="line">    cv::Mat result;</div>
<div class="line">    cv::bilateralFilter(*inputImg, result, d, sigmaCol, sigmaSpace);</div>
<div class="line"> </div>
<div class="line">    // Store the result</div>
<div class="line">    nodePorts.output&lt;ColImageData&gt;(OUTPUT_IMAGE, result);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">std::function&lt;std::unique_ptr&lt;nitro::NitroNode&gt;()&gt; nitro::BilateralFilterOperator::creator(const QString &amp;category) {</div>
<div class="line">    return [category]() {</div>
<div class="line">        nitro::NitroNodeBuilder builder(&quot;Bilateral Filter&quot;, &quot;bilateralFilter&quot;, category);</div>
<div class="line">        return builder.</div>
<div class="line">                withOperator(std::make_unique&lt;nitro::BilateralFilterOperator&gt;())-&gt;</div>
<div class="line">                withIcon(&quot;blur.png&quot;)-&gt;</div>
<div class="line">                withNodeColor(NITRO_FILTER_COLOR)-&gt;</div>
<div class="line">                withInputPort&lt;ColImageData&gt;(INPUT_IMAGE)-&gt;</div>
<div class="line">                withInputInteger(INPUT_D, 9, 1, 64)-&gt;</div>
<div class="line">                withInputValue(INPUT_SIGMA_C, 75, 2, 255)-&gt;</div>
<div class="line">                withInputValue(INPUT_SIGMA_S, 75, 2, 255)-&gt;</div>
<div class="line">                withOutputPort&lt;ColImageData&gt;(OUTPUT_IMAGE)-&gt;</div>
<div class="line">                build();</div>
<div class="line">    };</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md23"></a>
Data Types</h2>
<p>New data types can be added by creating an implementation of <code>QtNodes::NodeData</code>. For example, the <a href="../../../include/nodes/datatypes/integerdata.hpp">integer data type</a> has the following structure:</p>
<p><a href="../../../include/nodes/datatypes/integerdata.hpp">Header file</a></p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">#pragma once</div>
<div class="line"> </div>
<div class="line">#include &lt;utility&gt;</div>
<div class="line"> </div>
<div class="line">#include &quot;QtNodes/NodeData&quot;</div>
<div class="line">#include &quot;flexibledata.hpp&quot;</div>
<div class="line"> </div>
<div class="line">namespace nitro {</div>
<div class="line">    class IntegerData : public FlexibleData&lt;int, IntegerData&gt; {</div>
<div class="line">    public:</div>
<div class="line">        IntegerData();</div>
<div class="line"> </div>
<div class="line">        explicit IntegerData(int value);</div>
<div class="line"> </div>
<div class="line">        static QString id() {</div>
<div class="line">            return id_;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        static void registerConversions();</div>
<div class="line"> </div>
<div class="line">        [[nodiscard]] QString getDescription() const override;</div>
<div class="line"> </div>
<div class="line">    private:</div>
<div class="line">        inline static const QString name_ = &quot;Integer&quot;;</div>
<div class="line">        inline static const QString id_ = &quot;Integer&quot;;</div>
<div class="line">        inline static const QColor baseColor_ = {89, 140, 92};</div>
<div class="line">    };</div>
<div class="line">} // nitro</div>
</div><!-- fragment --><p><a href="../../../src/core/nodes/datatypes/integerdata.cpp">Source file</a></p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">#include &lt;nodes/datatypes/integerdata.hpp&gt;</div>
<div class="line">#include &lt;nodes/datatypes/decimaldata.hpp&gt;</div>
<div class="line"> </div>
<div class="line">namespace nitro {</div>
<div class="line">    IntegerData::IntegerData() : FlexibleData&lt;int, IntegerData&gt;(0, id_, name_, baseColor_) {</div>
<div class="line">        // By default, always allow conversions from doubles</div>
<div class="line">        allowConversionFrom(DecimalData::id());</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    IntegerData::IntegerData(int value) : FlexibleData&lt;int, IntegerData&gt;(value, id_, name_, baseColor_) {</div>
<div class="line">        // By default, always allow conversions from doubles</div>
<div class="line">        allowConversionFrom(DecimalData::id());</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    QString IntegerData::getDescription() const {</div>
<div class="line">        return QString::number(data());</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    void IntegerData::registerConversions() {</div>
<div class="line"> </div>
<div class="line">        // Every type needs a &quot;conversion&quot; to itself</div>
<div class="line">        IntegerData::registerConversionFrom&lt;IntegerData&gt;(</div>
<div class="line">                [](const std::shared_ptr&lt;QtNodes::NodeData&gt; &amp;nodeData) {</div>
<div class="line">                    return std::static_pointer_cast&lt;IntegerData&gt;(nodeData)-&gt;data();</div>
<div class="line">                });</div>
<div class="line"> </div>
<div class="line">        IntegerData::registerConversionFrom&lt;DecimalData&gt;(</div>
<div class="line">                [](const std::shared_ptr&lt;QtNodes::NodeData&gt; &amp;nodeData) {</div>
<div class="line">                    auto doubleData = std::static_pointer_cast&lt;DecimalData&gt;(nodeData);</div>
<div class="line">                    return int(std::round(doubleData-&gt;data()));</div>
<div class="line">                });</div>
<div class="line">    }</div>
<div class="line">} // nitro</div>
</div><!-- fragment --><p>Data types allow for custom conversions. These are defined in the <code>registerConversions()</code> function. Note that not all the conversions. By default, only the conversions registered in the constructor are enabled. If more conversions should be supported, then these should be specified in the node builder (see e.g. <a href="../../../modules/imcore/src/nodes/converter/immath.cpp">immath.cpp</a>). </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
